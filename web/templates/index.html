{% extends 'base.html' %}

{% block title %}Autograder-gen{% endblock %}

{% block content %}
<h1>Autograder-gen</h1>

<!-- Alert container for validation messages -->
<div id="alert-container"></div>


<div class="d-flex gap-2 flex-wrap">
  <button type="button" class="btn btn-success" onclick="validateConfig()">Validate Config</button>
  <button type="button" class="btn btn-info" onclick="downloadJsonConfig()">Download JSON Config</button>
  <button type="button" class="btn btn-primary" id="generate-btn" onclick="submitForGeneration()" disabled>Generate Autograder</button>
</div>
<div class="form-text mt-2">
  <small class="text-muted">
    <i class="fas fa-info-circle"></i> The Generate Autograder button will be enabled after successful validation.
  </small>
</div>
</form>

<!-- Config Upload Section -->
<div class="card mb-4">
  <div class="card-header">
    <h5 class="mb-0">Upload Existing Configuration</h5>
  </div>
  <div class="card-body">
    <div class="mb-3">
      <label for="config-upload" class="form-label">Upload JSON Config File</label>
      <input type="file" class="form-control" id="config-upload" accept=".json" onchange="handleConfigUpload(this)">
      <div class="form-text">Upload a previously exported JSON configuration file to populate the form.</div>
    </div>
  </div>
</div>

<form id="autograder-form" method="post" action="/validate">
  <h3>Global Configuration</h3>
  <div class="row mb-3">
    <div class="col-md-6">
      <label for="language" class="form-label">Programming Language</label>
      <select class="form-select" id="language" name="language" required>
        <option value="python">Python</option>
      </select>
    </div>
  </div>
  <div class="mb-3">
    <label for="global_time_limit" class="form-label">Global Time Limit (seconds)</label>
    <input type="number" class="form-control" id="global_time_limit" name="global_time_limit" value="300" min="1" max="36000">
    <div class="form-text">Maximum time allowed for all tests to complete</div>
  </div>
  <div class="mb-3">
    <label for="setup_commands" class="form-label">Setup Commands (optional)</label>
    <textarea class="form-control" id="setup_commands" name="setup_commands" rows="3" 
              placeholder="pip install numpy pandas matplotlib&#10;apt-get update"></textarea>
    <div class="form-text">One command per line. These will be executed before running tests.</div>
  </div>
  <div class="mb-3">
    <label class="form-label">Required Files</label>
    <div id="required-files-container">
      <div class="input-group mb-2">
        <input type="text" class="form-control" id="new-file-input" placeholder="Enter filename (e.g., solution.py)">
        <button type="button" class="btn btn-outline-secondary" onclick="addRequiredFile()">
          <i class="fas fa-plus"></i> Add File
        </button>
      </div>
      <div id="required-files-list" class="border rounded p-2 bg-light" style="min-height: 60px;">
        <small class="text-muted">No required files added yet. Students must submit these files.</small>
      </div>
    </div>
    <!-- Hidden textarea to maintain form compatibility -->
    <textarea class="d-none" id="files_necessary" name="files_necessary" required></textarea>
    <div class="form-text">Add the files that students must submit. Click the file names to edit them.</div>
  </div>
  <hr>
  <h3>Questions</h3>
  <div id="questions-list"></div>
  <button type="button" class="btn btn-primary mb-3" onclick="addQuestion()">Add Question</button>
  <hr>

{% endblock %}

{% block scripts %}
<!-- Load JavaScript modules in dependency order -->
<script src="/static/js/drag-drop.js"></script>
<script src="/static/js/error-handling.js"></script>
<script src="/static/js/required-files-management.js"></script>
<script src="/static/js/form-validation.js"></script>
<script src="/static/js/form-data-processing.js"></script>
<script src="/static/js/marking-item-management.js"></script>
<script src="/static/js/question-management.js"></script>
<script src="/static/js/config-upload.js"></script>
<script src="/static/js/api-communication.js"></script>
<script src="/static/js/main.js"></script>
{% endblock %} 